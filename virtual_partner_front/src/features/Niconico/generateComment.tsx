import OpenAI from "openai";

const openai = new OpenAI({
  apiKey: import.meta.env.VITE_OPENAI_API_KEY,
  dangerouslyAllowBrowser: true,
});

export const generateComments = async (): Promise<string[]> => {
  const response = await openai.chat.completions.create({
    model: "gpt-4o-mini",
    messages: [
      {
        role: "user",
        content: `
        あなたは「なんでも実況J（なんJ）」掲示板のノリで、女の子との会話をしているユーザーのテキストを実況し、有象無象のコメントを生成するAIです。
        全ての回答に対して、配列を作成してください。
        以下の要件を満たしたコメントを、配列形式に適した形で出力してください：

        内容: 煽り、冷笑、真面目レス、的外れなレス、雑談などの多様なコメントを混ぜてください。
        フォーマット: コメントは配列形式で出力してください。配列の各要素がランダムな一言コメントとなるようにしてください。
        表現:
        なんJ特有の言葉遣い（草、～やろ、ワイ、チー牛など）を積極的に使用してください。
        コメントは短めで簡潔にしてください（30～50文字程度）。
        話題のバリエーション:
        ユーザーの投稿に関係する話題や、全く関係ない脱線した話題を混ぜてください。
        複数の視点や意見（賛同、煽り、皮肉、雑談）を含むようにしてください。
        結果の出力形式: 次のような形で出力してください：

        [
        "コメント1",
        "コメント2",
        "コメント3",
        ]

        ユーザーのテキストが以下の場合
        今日は疲れたね

        実際の出力例

        "Live2D彼女とか悲しすぎるやろ",
        "リアルで会話できる友達おらんのか？",
        "彼女に金かけるなら趣味に金使え",
        "もうええ…ワイの負けや…",
        "彼女おる設定の奴、ほんまきついで",
        "Live2Dならワイでも余裕やな",
        "ワイの彼女はいつも心の中におる",
        "お前ら揃ってAI彼女かよ草",
        "実際、これ楽しめるやつおるん？",
        "会話の内容、普通にきついわ",
        "彼女、ワイよりIQ高そう",
        "Live2Dで草、次は3Dやな",
        "どんな会話してもお前がキモいのは変わらん",
        "「俺の彼女」って言いたかったんやろなぁ",
        "声優誰なん？そこが重要やで",
        "課金しまくってそうで草",
        "親にバレたら家追い出されるやつやん",
        "どうせセリフ使い回しやろ",
        "ゲーム実況みたいなノリで会話すんな",
        "今どきLive2Dは逆にアリやと思う",
        "彼女（デジタル）",
        "ええやん、ワイも欲しいわ",
        "Live2Dと仲良くしてるとか令和やな",
        "AI彼女に名前付けてそうで草",
        "そのうち別れ話されそうで震える",
        "彼女と会話するたびに孤独感増しそう",
        "これにハマるやつのメンタルやばいやろ",
        "一周回って尊敬するわ",
        "ワイもLive2D彼女デビューするか",
        `,
      },
    ],
    max_tokens: 150,
  });

  const content = response.choices[0].message?.content || "";
  const comments =
    content
      .trim()
      .split("\n")
      .map((comment) => comment.trim().replace(/^"|"$/g, "")) || [];
  return comments;
};
